<!DOCTYPE html>
{% load static %}
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ğŸ“š Enco Library Chatbot</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      rel="stylesheet"
      as="style"
      crossorigin
      href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.6/dist/web/static/pretendard.css"
    />
    <link rel="stylesheet" href="{% static 'mainapp/style.css' %}" />
  </head>
  <body>
    <header>ğŸ“š Enco Library</header>
    <main>
      <div class="container">
        <!-- <div class="sidebar">
          <div class="log-title">ğŸ“‘ ëŒ€í™” ê¸°ë¡</div>
          <div class="chat-log"></div>
        </div> -->
        <div class="chat-room">
          <div class="chatting" id="chatting"></div>
          <div class="message-input">
            <input
              type="text"
              id="user-input"
              placeholder="ì§ˆë¬¸ì–‘ì‹: ì œëª©ì´ {ì œëª©}ì¸ ì±…ì— ëŒ€í•´ì„œ ì•Œë ¤ì¤˜ {ì‘ê°€ì´ë¦„} ì‘ê°€ì˜ ì±…ì„ ì•Œë ¤ì¤˜ {ë¶„ì•¼} ì±…ì„ ì•Œë ¤ì¤˜"
            />
            <button onclick="sendMessage()">ì „ì†¡</button>
          </div>
        </div>
      </div>
    </main>
    <script>
      let currentChat = [];
      let chatHistory = [];
      const userInput = document.getElementById("user-input");
      const chatting = document.getElementById("chatting");
      const chatLog = document.querySelector(".chat-log");

      // ë©”ì‹œì§€ ì¶”ê°€
      function appendMessage(content, sender) {
        const messageDiv = document.createElement("div");
        messageDiv.classList.add("message", sender);
        messageDiv.textContent = content;
        chatting.appendChild(messageDiv);
        chatting.scrollTop = chatting.scrollHeight;
      }

      // ë©”ì‹œì§€ ì „ì†¡
      function sendMessage() {
        const userMessage = userInput.value.trim();
        if (userMessage) {
          appendMessage(userMessage, "user");
          currentChat.push({ sender: "user", content: userMessage });

          userInput.value = "";
          setTimeout(() => {
            const chatbotMessage = chatbotResponse(userMessage);
            appendMessage(chatbotMessage, "chatbot");
            currentChat.push({
              sender: "chatbot",
              content: chatbotMessage,
            });
          }, 500);
        }
      }

      userInput.addEventListener("keypress", (event) => {
        if (event.key === "Enter") {
          event.preventDefault();
          sendMessage();
        }
      });

      // ì˜ˆì‹œ ì‘ë‹µ ìƒì„±
      function chatbotResponse(userMessage) {
        let response = "Enco Library ì±—ë´‡ì…ë‹ˆë‹¤.";
        //saveChatHistory();
        return response;
      }

      // ëŒ€í™” ê¸°ë¡ ì €ì¥
      function saveChatHistory() {
        if (currentChat.length > 0) {
          chatHistory.push([...currentChat]);

          const historyItem = document.createElement("div");
          historyItem.classList.add("history-item");
          historyItem.textContent = `Chat ${chatHistory.length}`;
          historyItem.onclick = () => loadSelectedChat(chatHistory.length - 1);

          chatLog.appendChild(historyItem);
          currentChat = [];
        }
      }

      // ì„ íƒí•œ ëŒ€í™” ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
      function loadSelectedChat(index) {
        chatting.innerHTML = "";

        // ì„ íƒí•œ ëŒ€í™”ì˜ ì§ˆë¬¸ê³¼ ë‹µë³€ë§Œ í‘œì‹œ
        const selectedChat = chatHistory[index];
        selectedChat.forEach((entry) => {
          appendMessage(entry.content, entry.sender);
        });
      }
    </script>
  </body>
</html>
